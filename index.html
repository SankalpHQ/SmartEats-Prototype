<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartEats - Cafeteria Ordering System</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #d1d5db; border-radius: 20px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .screen { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        .cart-bounce { animation: bounce 0.5s ease-in-out; }
        .pulse-active { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .star-rating .star { color: #d1d5db; cursor: pointer; transition: color 0.2s; }
        .star-rating .star.selected { color: #f59e0b; }
        .modal-backdrop, .toast-notification { animation: fadeInBackdrop 0.3s ease-in-out; }
        .modal-content { animation: fadeInModal 0.3s ease-in-out; }
        @keyframes fadeInBackdrop { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInModal { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } }
        .toast-fade-out { animation: fadeOut 0.5s ease-in-out forwards; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        #bottom-nav.floating {
            left: 50%;
            transform: translateX(-50%);
            bottom: 1.5rem;
            width: 90%;
            border-radius: 9999px;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1);
            border-top: none;
            height: 4.5rem;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B00',
                        'primary-dark': '#E65A00',
                        'primary-light': '#FFF5EC',
                        secondary: '#1A202C',
                        light: '#F7FAFC',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-200 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-sm h-[85vh] max-h-[812px] bg-light rounded-[40px] shadow-2xl overflow-hidden border-8 border-gray-800 relative flex flex-col">
        <main id="app-container" class="flex-1 overflow-y-auto custom-scrollbar bg-light"></main>
        <nav id="bottom-nav" class="absolute bg-white flex justify-around items-center"></nav>
        <div id="cart-fab-container" class="absolute bottom-28 right-5" style="display: none;"></div>
        <div id="modal-container"></div>
        <div id="toast-container" class="absolute bottom-28 left-1/2 -translate-x-1/2 w-full max-w-xs z-50"></div>
    </div>

    <script>
        // --- DATA MOCKUP ---
        let menuItems = [
            { id: 1, name: 'Chole Bhature', price: 120, category: 'Lunch', image: 'https://tse4.mm.bing.net/th/id/OIP.kTGRpPyhDe-DkT-PqkWNSAHaLH?pid=Api&P=0&h=180', veg: true, rating: 4.8, calories: 450, isSpecial: true, description: "A classic North Indian dish featuring spicy chickpea curry served with fluffy, deep-fried bread.", isAvailable: true },
            { id: 2, name: 'Masala Dosa', price: 90, category: 'Breakfast', image: 'https://tse3.mm.bing.net/th/id/OIP.rjPWdpnilxr1aLeTyTlGLgHaLG?pid=Api&P=0&h=180', veg: true, rating: 4.9, calories: 380, isSpecial: false, description: "A crispy, savory pancake filled with a spiced potato mixture. Served with sambar and chutney.", isAvailable: true },
            { id: 3, name: 'Chicken Biryani', price: 180, category: 'Lunch', image: 'https://images.unsplash.com/photo-1589302168068-964664d93dc0?q=80&w=800&auto=format&fit=crop', veg: false, rating: 4.7, calories: 650, isSpecial: true, description: "Fragrant basmati rice cooked with succulent pieces of chicken and exotic spices.", isAvailable: false },
            { id: 4, name: 'Veggie Burger', price: 85, category: 'Snacks', image: 'https://tse1.mm.bing.net/th/id/OIP.eSYtySJyuRPrbGYvZQxj-gHaKB?pid=Api&P=0&h=180', veg: true, rating: 4.5, calories: 520, isSpecial: true, description: "A delicious and juicy vegetable patty topped with lettuce, tomato, and our special sauce.", isAvailable: true },
            { id: 6, name: 'Cold Coffee', price: 70, category: 'Beverages', image: 'https://tse3.mm.bing.net/th/id/OIP.cTc4_DNWyiy3Ani_6Y6suQHaKe?pid=Api&P=0&h=180', veg: true, rating: 4.8, calories: 250, isSpecial: true, description: "A rich and creamy cold coffee, perfectly blended to give you a refreshing kick.", isAvailable: true },
            { id: 8, name: 'Iced Tea', price: 60, category: 'Beverages', image: 'https://tse3.mm.bing.net/th/id/OIP.iP8FHdkpOEp-HWZyfQd6VQHaLH?pid=Api&P=0&h=180', veg: true, rating: 4.6, calories: 90, isSpecial: false, description: "A refreshing lemon-flavored iced tea, brewed to perfection. The ultimate thirst quencher.", isAvailable: true },
        ];
        let orderHistory = [
            { id: '#SE312', date: 'Oct 12, 2025', total: 210, items: [{ id: 2, qty: 1 }, { id: 1, qty: 1 }], status: 'Collected', rated: false },
            { id: '#SE289', date: 'Oct 10, 2025', total: 155, items: [{ id: 4, qty: 1 }, { id: 8, qty: 1 }], status: 'Collected', rated: true },
        ];
        let kitchenOrders = [
            { token: '112', id: 'order-112', items: [{name: 'Masala Dosa', qty: 1}, {name: 'Cold Coffee', qty: 1}], time: '7:05 PM', status: 'new'},
            { token: '111', id: 'order-111', items: [{name: 'Chole Bhature', qty: 2}], time: '7:02 PM', status: 'preparing'},
            { token: '109', id: 'order-109', items: [{name: 'Veggie Burger', qty: 1}], time: '6:58 PM', status: 'ready'},
        ];

        // --- APP STATE ---
        let cart = [];
        let currentUser = { name: 'Guest' };
        let currentOrder = {
            scheduledTime: 'Now'
        };
        let activeFilter = { category: 'All', searchTerm: '' };
        let adminActiveTab = 'live-orders';

        // --- DOM ELEMENTS ---
        const app = {
            container: document.getElementById('app-container'),
            nav: document.getElementById('bottom-nav'),
            fab: document.getElementById('cart-fab-container'),
            modal: document.getElementById('modal-container'),
            toast: document.getElementById('toast-container'),
        };
        
        // --- SCREEN TEMPLATES ---
        const screens = {
            'login': () => `
                <div class="screen bg-secondary h-full flex flex-col justify-center items-center p-8 text-white text-center">
                    <svg class="w-24 h-24 text-primary" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M32 59.5C40.5604 59.5 47.5 52.5604 47.5 44C47.5 35.4396 40.5604 28.5 32 28.5C23.4396 28.5 16.5 35.4396 16.5 44C16.5 52.5604 23.4396 59.5 32 59.5Z" stroke="currentColor" stroke-width="5" stroke-miterlimit="10"/>
                        <path d="M24 28.5V7C24 5.34315 25.3431 4 27 4H37C38.6569 4 40 5.34315 40 7V28.5" stroke="currentColor" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M28 4V14" stroke="currentColor" stroke-width="5" stroke-linecap="round"/>
                        <path d="M36 4V14" stroke="currentColor" stroke-width="5" stroke-linecap="round"/>
                    </svg>
                    <h1 class="text-5xl font-black text-primary mt-4">SmartEats</h1>
                    <p class="mt-2 text-lg text-gray-300">Cafeteria, simplified.</p>
                    <div class="mt-16 w-full">
                        <button onclick="handleLogin('Alex Johnson')" class="w-full bg-gradient-to-r from-primary to-orange-400 text-white font-bold py-4 px-6 rounded-xl text-lg hover:shadow-lg transition-all transform hover:scale-105">Login with College ID</button>
                        <button onclick="showScreen('signup')" class="mt-4 w-full bg-gray-700 text-gray-300 font-semibold py-3 px-6 rounded-xl hover:bg-gray-600 transition-colors">Sign Up with Email</button>
                    </div>
                </div>`,
            'signup': () => `
                <div class="screen p-5">
                     <header class="flex items-center mb-8">
                        <button onclick="showScreen('login')" class="p-2 -ml-2 rounded-full hover:bg-gray-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-gray-700"><path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 010 1.06l-6.22 6.22H21a.75.75 0 010 1.5H4.81l6.22 6.22a.75.75 0 11-1.06 1.06l-7.5-7.5a.75.75 0 010-1.06l7.5-7.5a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg></button>
                        <h2 class="text-2xl font-bold text-secondary ml-2">Create Account</h2>
                    </header>
                    <div class="space-y-4">
                        <div>
                            <label class="font-semibold text-gray-600">Full Name</label>
                            <input id="signup-name" type="text" placeholder="Your Name" class="w-full mt-1 bg-white border-2 border-gray-200 rounded-lg py-3 px-4 focus:outline-none focus:border-primary transition-colors">
                        </div>
                        <div>
                            <label class="font-semibold text-gray-600">College Email</label>
                            <input type="email" placeholder="your.name@college.edu" class="w-full mt-1 bg-white border-2 border-gray-200 rounded-lg py-3 px-4 focus:outline-none focus:border-primary transition-colors">
                        </div>
                        <div>
                            <label class="font-semibold text-gray-600">Password</label>
                            <input type="password" placeholder="••••••••" class="w-full mt-1 bg-white border-2 border-gray-200 rounded-lg py-3 px-4 focus:outline-none focus:border-primary transition-colors">
                        </div>
                    </div>
                    <button onclick="handleSignup()" class="w-full mt-8 bg-gradient-to-r from-primary to-orange-400 text-white font-bold py-4 rounded-xl text-lg hover:shadow-lg transition-all">Create Account</button>
                </div>`,
            'home': () => {
                const availableItems = menuItems.filter(item => item.isAvailable);
                const categories = ['All', ...new Set(availableItems.map(item => item.category))];
                const specials = availableItems.filter(item => item.isSpecial);
                const filteredItems = availableItems.filter(item => 
                    (activeFilter.category === 'All' || item.category === activeFilter.category) &&
                    item.name.toLowerCase().includes(activeFilter.searchTerm.toLowerCase())
                );
                return `
                <div class="screen">
                    <header class="p-5">
                        <p class="text-md text-gray-500">Welcome back,</p>
                        <h2 class="text-3xl font-bold text-secondary">${currentUser.name}</h2>
                    </header>
                    <div class="px-5">
                        <div class="relative">
                            <input type="text" id="search-input" onkeyup="handleSearch(this.value)" placeholder="Search for food..." class="w-full bg-white border-2 border-gray-200 rounded-xl py-3 pl-12 pr-4 focus:outline-none focus:border-primary transition-colors" value="${activeFilter.searchTerm}">
                            <svg class="w-6 h-6 text-gray-400 absolute left-4 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h3 class="px-5 text-xl font-bold text-secondary mb-3">Today's Specials</h3>
                        <div class="flex space-x-4 pl-5 overflow-x-auto custom-scrollbar pb-3">
                            ${specials.map(item => `
                                <div onclick="showScreen('item-detail', ${item.id})" class="flex-shrink-0 w-2/3 bg-white rounded-xl shadow-sm overflow-hidden cursor-pointer transform hover:-translate-y-1 transition-transform">
                                    <img class="w-full h-28 object-cover" src="${item.image}" alt="${item.name}">
                                    <div class="p-3">
                                        <h4 class="font-bold text-md truncate">${item.name}</h4>
                                        <p class="text-primary font-semibold text-md">₹${item.price}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="mt-6 px-5">
                        <div class="flex space-x-3 overflow-x-auto custom-scrollbar pb-3">
                            ${categories.map(cat => `
                                <button onclick="handleFilter('${cat}')" class="category-btn whitespace-nowrap px-5 py-2 rounded-lg text-sm font-semibold ${activeFilter.category === cat ? 'bg-secondary text-white' : 'bg-white text-gray-600'} transition-colors">
                                    ${cat}
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <div id="menu-grid" class="mt-4 px-5 grid grid-cols-1 gap-5">
                        ${filteredItems.length > 0 ? filteredItems.map(item => createMenuItemCard(item)).join('') : '<p class="text-center text-gray-500 col-span-1 py-10">No items match your search.</p>'}
                    </div>
                </div>`;
            },
            'item-detail': (itemId) => {
                const item = menuItems.find(i => i.id === itemId);
                return `
                <div class="screen bg-white">
                    <div class="relative">
                        <img src="${item.image}" class="w-full h-64 object-cover">
                        <button onclick="showScreen('home')" class="absolute top-5 left-5 bg-white/70 p-2 rounded-full backdrop-blur-sm hover:bg-white transition-colors">
                             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-secondary"><path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 010 1.06l-6.22 6.22H21a.75.75 0 010 1.5H4.81l6.22 6.22a.75.75 0 11-1.06 1.06l-7.5-7.5a.75.75 0 010-1.06l7.5-7.5a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                    <div class="p-5">
                         <div class="flex justify-between items-start">
                             <h2 class="text-3xl font-bold text-secondary">${item.name}</h2>
                             <div class="flex items-center space-x-1 text-yellow-500">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" /></svg>
                                <span class="font-bold text-lg text-gray-700">${item.rating}</span>
                             </div>
                         </div>
                         <p class="text-gray-500 mt-2">${item.description}</p>
                         <p class="text-sm text-gray-400 mt-2">${item.calories} kcal</p>
                    </div>
                     <div class="fixed bottom-0 left-0 right-0 max-w-sm mx-auto p-5 bg-white border-t">
                        <div class="flex justify-between items-center">
                            <p class="text-3xl font-black text-secondary">₹${item.price}</p>
                            <button onclick="addToCart(${item.id}); showToast('${item.name} added to cart');" class="bg-gradient-to-r from-primary to-orange-400 text-white font-bold py-3 px-8 rounded-lg text-lg flex items-center space-x-2 hover:shadow-lg transition-all">
                                <span>Add to Cart</span>
                            </button>
                        </div>
                    </div>
                </div>`;
            },
            'cart': () => {
                const subtotal = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
                const tax = subtotal * 0.05;
                const total = subtotal + tax;

                if (cart.length === 0) {
                    return `
                    <div class="screen p-5">
                        <header class="flex items-center mb-6">
                            <button onclick="showScreen('home')" class="p-2 -ml-2 rounded-full hover:bg-gray-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-gray-700"><path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 010 1.06l-6.22 6.22H21a.75.75 0 010 1.5H4.81l6.22 6.22a.75.75 0 11-1.06 1.06l-7.5-7.5a.75.75 0 010-1.06l7.5-7.5a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg></button>
                            <h2 class="text-2xl font-bold text-secondary ml-2">My Cart</h2>
                        </header>
                        <div class="text-center mt-20">
                            <p class="text-gray-500 text-lg">Your cart is empty.</p>
                            <button onclick="showScreen('home')" class="mt-4 bg-primary text-white font-bold py-3 px-6 rounded-lg">Start Ordering</button>
                        </div>
                    </div>`;
                }

                return `
                <div class="screen p-5">
                    <header class="flex items-center mb-6">
                        <button onclick="showScreen('home')" class="p-2 -ml-2 rounded-full hover:bg-gray-100">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-gray-700"><path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 010 1.06l-6.22 6.22H21a.75.75 0 010 1.5H4.81l6.22 6.22a.75.75 0 11-1.06 1.06l-7.5-7.5a.75.75 0 010-1.06l7.5-7.5a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg>
                        </button>
                        <h2 class="text-2xl font-bold text-secondary ml-2">My Cart</h2>
                    </header>
                    <div class="space-y-4">
                        ${cart.map(item => `
                            <div class="flex items-center bg-white p-3 rounded-xl shadow-sm">
                                <img src="${item.image}" class="w-20 h-20 rounded-lg object-cover">
                                <div class="flex-1 ml-4">
                                    <h4 class="font-bold text-gray-800">${item.name}</h4>
                                    <p class="text-primary font-semibold">₹${item.price}</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <button onclick="updateQuantity(${item.id}, -1)" class="w-8 h-8 bg-gray-200 rounded-full font-bold text-gray-700 flex items-center justify-center text-xl">-</button>
                                    <span class="font-bold text-lg w-5 text-center">${item.quantity}</span>
                                    <button onclick="updateQuantity(${item.id}, 1)" class="w-8 h-8 bg-gray-200 rounded-full font-bold text-gray-700 flex items-center justify-center text-xl">+</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="mt-8 bg-white p-4 rounded-xl shadow-sm">
                        <h3 class="font-bold text-lg mb-3">Pickup Time</h3>
                        <div id="pickup-time-selector" class="flex space-x-2">
                            <button onclick="setPickupTime('Now')" class="flex-1 py-2 text-sm font-semibold ${currentOrder.scheduledTime === 'Now' ? 'bg-primary-light text-primary border-primary' : 'bg-gray-100 text-gray-600 border-transparent'} rounded-lg border-2">Now</button>
                            <button onclick="showScheduleModal()" class="flex-1 py-2 text-sm font-semibold ${currentOrder.scheduledTime !== 'Now' ? 'bg-primary-light text-primary border-primary' : 'bg-gray-100 text-gray-600 border-transparent'} rounded-lg border-2">${currentOrder.scheduledTime !== 'Now' ? currentOrder.scheduledTime : 'Schedule'}</button>
                        </div>
                    </div>

                    <div class="mt-4 bg-white p-4 rounded-xl shadow-sm">
                        <div class="flex justify-between text-gray-600"><p>Subtotal</p> <p>₹${subtotal.toFixed(2)}</p></div>
                        <div class="flex justify-between text-gray-600 mt-2"><p>Taxes (5%)</p> <p>₹${tax.toFixed(2)}</p></div>
                        <div class="border-t my-3"></div>
                        <div class="flex justify-between font-bold text-xl text-secondary"><p>Total</p><p>₹${total.toFixed(2)}</p></div>
                    </div>
                    
                    <button onclick="showScreen('payment-processing')" class="w-full mt-6 bg-gradient-to-r from-primary to-orange-400 text-white font-bold py-4 rounded-xl text-lg hover:shadow-lg hover:from-primary-dark transition-all">Proceed to Payment</button>
                </div>`;
            },
            'payment-processing': () => `
                <div class="screen flex flex-col items-center justify-center h-full text-center p-8">
                    <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
                    <h2 class="text-2xl font-bold text-secondary mt-6">Processing Payment...</h2>
                    <p class="text-gray-500">Please wait, do not close the app.</p>
                </div>`,
            'payment-success': () => `
                <div class="screen flex flex-col items-center justify-center h-full text-center p-8">
                    <div class="w-24 h-24 bg-green-100 text-green-500 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
                    </div>
                    <h2 class="text-2xl font-bold text-secondary mt-6">Payment Successful!</h2>
                    <p class="text-gray-500">Your order is confirmed. Redirecting...</p>
                </div>`,
            'order-tracking': () => {
                return `
                <div class="screen p-5">
                    <header class="flex items-center mb-6">
                        <button onclick="showScreen('home')" class="p-2 -ml-2 rounded-full hover:bg-gray-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-gray-700"><path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 010 1.06l-6.22 6.22H21a.75.75 0 010 1.5H4.81l6.22 6.22a.75.75 0 11-1.06 1.06l-7.5-7.5a.75.75 0 010-1.06l7.5-7.5a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg></button>
                        <h2 class="text-2xl font-bold text-secondary ml-2">Track Order</h2>
                    </header>
                    <div class="p-6 bg-white rounded-xl shadow-md">
                        <div class="flex justify-between items-center mb-8 text-center">
                            <div>
                                <p class="text-sm text-gray-500">Your Token</p>
                                <p class="text-5xl font-black text-primary">${currentOrder.token}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-500">Order ID</p>
                                <p class="text-base font-semibold text-gray-700">${currentOrder.id}</p>
                            </div>
                        </div>
                        <ol id="order-tracker-list" class="relative border-l-2 border-dashed border-gray-200"></ol>
                    </div>
                </div>`;
            },
            'order-history': () => `
                <div class="screen p-5">
                    <header class="mb-6"><h2 class="text-3xl font-bold text-secondary">Order History</h2></header>
                    <div class="space-y-4">
                        ${orderHistory.map(order => {
                            const itemsWithNames = order.items.map(item => {
                                const menuItem = menuItems.find(mi => mi.id === item.id);
                                return { ...item, name: menuItem ? menuItem.name : 'Unknown Item' };
                            });
                            return `
                            <div class="bg-white p-4 rounded-xl shadow-sm">
                                <div class="flex justify-between items-center">
                                    <p class="font-bold text-gray-800">${order.id}</p>
                                    <span class="text-xs font-semibold ${order.status === 'Collected' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600'} px-2 py-1 rounded-full">${order.status}</span>
                                </div>
                                <p class="text-sm text-gray-500 mt-1">${order.date}</p>
                                <p class="text-sm text-gray-600 mt-2">${itemsWithNames.map(i => `${i.qty}x ${i.name}`).join(', ')}</p>
                                <div class="border-t my-3"></div>
                                <div class="flex justify-between items-center">
                                    <p class="font-bold text-lg">₹${order.total.toFixed(2)}</p>
                                    <div class="flex space-x-2">
                                        ${!order.rated ? `<button onclick="showRatingModal('${order.id}')" class="bg-yellow-100 text-yellow-800 font-semibold py-2 px-4 rounded-lg text-sm hover:bg-yellow-200 transition-colors">Rate</button>` : ''}
                                        <button onclick="reOrderItems('${order.id}')" class="bg-gray-100 text-gray-700 font-semibold py-2 px-4 rounded-lg text-sm hover:bg-gray-200 transition-colors">Re-order</button>
                                    </div>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                </div>`,
            'profile': () => `
                <div class="screen p-5">
                    <header class="mb-8"><h2 class="text-3xl font-bold text-secondary">Profile</h2></header>
                    <div class="flex items-center bg-white p-4 rounded-xl shadow-sm">
                        <img src="https://placehold.co/100x100/1A202C/FFFFFF?text=${currentUser.name.charAt(0)}" class="w-16 h-16 rounded-full object-cover">
                        <div class="ml-4">
                            <h3 class="font-bold text-xl text-gray-800">${currentUser.name}</h3>
                            <p class="text-gray-500">College ID: 23CS1089</p>
                        </div>
                    </div>
                    <div class="mt-6 space-y-2">
                        <button onclick="showScreen('payment-methods')" class="w-full text-left flex items-center justify-between p-4 bg-white rounded-lg shadow-sm text-gray-700 hover:bg-gray-50 transition-colors"><span class="font-semibold">Payment Methods</span><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></button>
                        <button onclick="showScreen('notifications')" class="w-full text-left flex items-center justify-between p-4 bg-white rounded-lg shadow-sm text-gray-700 hover:bg-gray-50 transition-colors"><span class="font-semibold">Notifications</span><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></button>
                        <button onclick="showScreen('help-support')" class="w-full text-left flex items-center justify-between p-4 bg-white rounded-lg shadow-sm text-gray-700 hover:bg-gray-50 transition-colors"><span class="font-semibold">Help & Support</span><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></button>
                    </div>
                    <button onclick="showScreen('login')" class="w-full mt-8 bg-red-50 text-red-600 font-bold py-3 rounded-xl hover:bg-red-100 transition-colors">Logout</button>
                </div>`,
            'payment-methods': () => `
                <div class="screen p-5">
                    <header class="flex items-center mb-6">
                        <button onclick="showScreen('profile')" class="p-2 -ml-2 rounded-full hover:bg-gray-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-gray-700"><path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 010 1.06l-6.22 6.22H21a.75.75 0 010 1.5H4.81l6.22 6.22a.75.75 0 11-1.06 1.06l-7.5-7.5a.75.75 0 010-1.06l7.5-7.5a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg></button>
                        <h2 class="text-2xl font-bold text-secondary ml-2">Payment Methods</h2>
                    </header>
                    <div class="space-y-3">
                        <div class="bg-white p-4 rounded-lg shadow-sm flex items-center justify-between">
                            <div class="flex items-center">
                                <img src="https://placehold.co/40x28/8B4513/FFFFFF?text=VISA" class="w-10 h-7 rounded"/>
                                <span class="ml-3 font-semibold">**** **** **** 1234</span>
                            </div>
                            <span class="text-xs bg-primary text-white font-semibold px-2 py-1 rounded-full">Primary</span>
                        </div>
                    </div>
                    <button class="w-full mt-6 border-2 border-dashed border-gray-300 text-gray-500 font-bold py-3 rounded-xl hover:bg-gray-100 transition-colors">+ Add New Card</button>
                </div>`,
            'notifications': () => `
                <div class="screen p-5">
                    <header class="flex items-center mb-6">
                        <button onclick="showScreen('profile')" class="p-2 -ml-2 rounded-full hover:bg-gray-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-gray-700"><path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 010 1.06l-6.22 6.22H21a.75.75 0 010 1.5H4.81l6.22 6.22a.75.75 0 11-1.06 1.06l-7.5-7.5a.75.75 0 010-1.06l7.5-7.5a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg></button>
                        <h2 class="text-2xl font-bold text-secondary ml-2">Notifications</h2>
                    </header>
                    <div class="space-y-2">
                        <div class="bg-white p-4 rounded-lg shadow-sm flex items-center justify-between">
                            <div><h3 class="font-semibold">Order Status Updates</h3><p class="text-sm text-gray-500">Receive alerts when your order is ready.</p></div>
                            <label class="inline-flex items-center cursor-pointer"><input type="checkbox" checked class="sr-only peer"><div class="relative w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div></label>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-sm flex items-center justify-between">
                            <div><h3 class="font-semibold">Promotions & Offers</h3><p class="text-sm text-gray-500">Get notified about special deals.</p></div>
                            <label class="inline-flex items-center cursor-pointer"><input type="checkbox" class="sr-only peer"><div class="relative w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div></label>
                        </div>
                    </div>
                </div>`,
            'help-support': () => `
                <div class="screen p-5">
                    <header class="flex items-center mb-6">
                        <button onclick="showScreen('profile')" class="p-2 -ml-2 rounded-full hover:bg-gray-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-gray-700"><path fill-rule="evenodd" d="M11.03 3.97a.75.75 0 010 1.06l-6.22 6.22H21a.75.75 0 010 1.5H4.81l6.22 6.22a.75.75 0 11-1.06 1.06l-7.5-7.5a.75.75 0 010-1.06l7.5-7.5a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg></button>
                        <h2 class="text-2xl font-bold text-secondary ml-2">Help & Support</h2>
                    </header>
                    <div class="space-y-2">
                        <div class="bg-white rounded-lg shadow-sm">
                            <button onclick="toggleAccordion(this)" class="w-full flex justify-between items-center p-4 font-semibold text-left">How do I track my order?<svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                            <div class="accordion-content px-4 text-gray-600 leading-relaxed"><div class="py-4 border-t"><p>You can track your order in real-time from the "Order History" tab. We'll also send you notifications when its status changes.</p></div></div>
                        </div>
                         <div class="bg-white rounded-lg shadow-sm">
                            <button onclick="toggleAccordion(this)" class="w-full flex justify-between items-center p-4 font-semibold text-left">Can I cancel my order?<svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                            <div class="accordion-content px-4 text-gray-600 leading-relaxed"><div class="py-4 border-t"><p>Unfortunately, once an order is placed, it cannot be canceled as the kitchen starts preparing it immediately. Please double-check your cart before confirming.</p></div></div>
                        </div>
                    </div>
                </div>`,
            'admin-dashboard': () => {
                const totalRevenue = orderHistory.reduce((sum, order) => sum + order.total, 0) + 540; // Simulating some other orders
                return `
                <div class="screen p-5 bg-gray-100 h-full flex flex-col">
                    <header class="mb-4">
                        <p class="text-md text-gray-500">Admin</p>
                        <h2 class="text-3xl font-bold text-secondary">Dashboard</h2>
                    </header>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-white p-3 rounded-xl shadow-sm"><p class="text-sm text-gray-500">Today's Revenue</p><p class="text-2xl font-bold">₹${totalRevenue.toFixed(2)}</p></div>
                        <div class="bg-white p-3 rounded-xl shadow-sm"><p class="text-sm text-gray-500">Total Orders</p><p class="text-2xl font-bold">${orderHistory.length + kitchenOrders.length}</p></div>
                    </div>
                    <div class="flex border-b-2 border-gray-200 mb-4">
                        <button onclick="setAdminTab('live-orders')" class="flex-1 py-2 font-semibold ${adminActiveTab === 'live-orders' ? 'border-b-2 border-primary text-primary' : 'text-gray-500'}">Live Orders</button>
                        <button onclick="setAdminTab('menu-manage')" class="flex-1 py-2 font-semibold ${adminActiveTab === 'menu-manage' ? 'border-b-2 border-primary text-primary' : 'text-gray-500'}">Menu Management</button>
                    </div>
                    <div id="admin-content" class="flex-1 overflow-y-auto custom-scrollbar -mr-5 -ml-2 px-2"></div>
                </div>`;
            }
        };
        
        // --- CORE FUNCTIONS (Full Implementation) ---
        function handleLogin(name) {
            currentUser.name = name;
            showScreen('home');
        }

        function handleSignup() {
            const nameInput = document.getElementById('signup-name');
            if (nameInput && nameInput.value.trim() !== '') {
                currentUser.name = nameInput.value.trim();
            } else {
                currentUser.name = 'New User'; // Fallback
            }
            showScreen('home');
        }

        function showScreen(screenName, ...args) {
            if (screens[screenName]) {
                app.container.innerHTML = screens[screenName](...args);
                updateUIForScreen(screenName);
                if(screenName === 'order-tracking') startOrderSimulation();
                if(screenName === 'admin-dashboard') renderAdminContent();
                if(screenName === 'payment-processing') {
                    setTimeout(() => showScreen('payment-success'), 2000);
                }
                if(screenName === 'payment-success') {
                    placeOrder();
                    setTimeout(() => showScreen('order-tracking'), 2000);
                }
            }
        }
        
        function updateUIForScreen(screenName) {
            const noNavScreens = ['login', 'signup', 'item-detail', 'payment-processing', 'payment-success'];
            const nav = document.getElementById('bottom-nav');
            const appContainer = document.getElementById('app-container');
            
            nav.className = `absolute bg-white flex justify-around items-center floating`;
            if(noNavScreens.includes(screenName)) {
                nav.classList.add('hidden');
                appContainer.classList.remove('pb-28');
                if(screenName === 'login' || screenName === 'signup') {
                    appContainer.style.backgroundColor = tailwind.config.theme.extend.colors.secondary;
                }
            } else {
                nav.classList.remove('hidden');
                appContainer.classList.add('pb-28');
                appContainer.style.backgroundColor = tailwind.config.theme.extend.colors.light;
            }


            app.fab.style.display = (screenName === 'home') ? 'block' : 'none';
            
            const screenToNavMap = {
                'home': 'home',
                'cart': 'home',
                'order-tracking': 'home',
                'order-history': 'order-history',
                'admin-dashboard': 'admin-dashboard',
                'profile': 'profile',
                'payment-methods': 'profile',
                'notifications': 'profile',
                'help-support': 'profile'
            };
            
            const activeNav = screenToNavMap[screenName] || 'home';

            document.querySelectorAll('.nav-item').forEach(item => {
                if(item.dataset.screen === activeNav) {
                    item.classList.add('text-primary');
                } else {
                    item.classList.remove('text-primary');
                }
            });
        }

        function createMenuItemCard(item) {
            return `
            <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300 ease-in-out transform hover:-translate-y-1 flex">
                <div class="w-1/3 relative" onclick="showScreen('item-detail', ${item.id})">
                    <img class="w-full h-full object-cover" src="${item.image}" alt="${item.name}">
                </div>
                <div class="p-3 w-2/3 flex flex-col justify-between">
                    <div>
                        <div class="flex justify-between items-start">
                             <h3 class="text-md font-bold text-gray-800 leading-tight pr-2">${item.name}</h3>
                             <div class="flex-shrink-0 w-5 h-5 border-2 ${item.veg ? 'border-green-500' : 'border-red-500'} rounded-full flex items-center justify-center"><div class="w-3 h-3 ${item.veg ? 'bg-green-500' : 'bg-red-500'} rounded-full"></div></div>
                        </div>
                        <div class="flex items-center text-sm text-yellow-500 mt-1">
                             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M10.868 2.884c.321-.662 1.215-.662 1.536 0l1.681 3.434 3.982.292c.74.054 1.036.992.498 1.492l-3.203 2.738 1.004 4.114c.168.69-.608 1.236-1.252.872l-3.64-2.29-3.64 2.29c-.644.364-1.42-.182-1.252-.872l1.004-4.114L2.165 8.1c-.538-.5-.242-1.438.498-1.492l3.982-.292 1.681-3.434z" clip-rule="evenodd" /></svg>
                             <span class="ml-1 text-gray-600 font-semibold">${item.rating}</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mt-2">
                        <p class="text-lg font-black text-gray-900">₹${item.price}</p>
                        <button onclick="addToCart(${item.id}); showToast('${item.name} added')" class="bg-primary-light text-primary font-bold py-2 px-4 rounded-lg flex items-center space-x-2 hover:bg-primary hover:text-white transition-colors duration-300">
                            <span>ADD</span>
                        </button>
                    </div>
                </div>
            </div>`;
        }
        function addToCart(itemId) {
            const itemInCart = cart.find(item => item.id === itemId);
            if (itemInCart) itemInCart.quantity++;
            else cart.push({ ...menuItems.find(item => item.id === itemId), quantity: 1 });
            updateCartCount();
        }
        function updateQuantity(itemId, change) {
            const itemInCart = cart.find(item => item.id === itemId);
            if (itemInCart) {
                itemInCart.quantity += change;
                if (itemInCart.quantity <= 0) cart = cart.filter(item => item.id !== itemId);
            }
            showScreen('cart');
            updateCartCount();
        }
        function updateCartCount() {
            const count = cart.reduce((acc, item) => acc + item.quantity, 0);
            const countElement = document.getElementById('cart-item-count');
            if(countElement) {
                countElement.textContent = count;
                if(count > 0) {
                    countElement.classList.add('cart-bounce');
                    setTimeout(() => countElement.classList.remove('cart-bounce'), 500);
                }
            }
        }
        function placeOrder() {
            if (cart.length > 0) {
                const total = cart.reduce((acc, item) => acc + item.price * item.quantity, 0) * 1.05;
                const newOrder = {
                    id: `#SE${Math.floor(Math.random() * 900) + 100}`,
                    date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                    total: total,
                    items: cart.map(item => ({ id: item.id, qty: item.quantity })),
                    status: 'Processing',
                    rated: false
                };
                orderHistory.unshift(newOrder); // Add to beginning of history
                currentOrder.id = newOrder.id;
                currentOrder.token = `#${Math.floor(Math.random() * 900) + 100}`;
                cart = [];
                currentOrder.scheduledTime = 'Now';
                updateCartCount();
            }
        }
        function startOrderSimulation() {
            const listEl = document.getElementById('order-tracker-list');
            if (!listEl) return;
            const now = new Date();
            const formatTime = (date) => date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });

            const statuses = [
                { name: 'Order Received', icon: 'M5 13l4 4L19 7', time: formatTime(now), state: 'completed' },
                { name: 'Preparing Food', icon: 'M10 2a8 8 0 100 16 8 8 0 000-16zm0 2a6 6 0 110 12A6 6 0 0110 4z', time: `Est. ~10 mins`, state: 'pending' },
                { name: 'Ready for Pickup', icon: 'M10 2a8 8 0 100 16 8 8 0 000-16zm0 2a6 6 0 110 12A6 6 0 0110 4z', time: '', state: 'pending' },
                { name: 'Order Collected', icon: 'M10 2a8 8 0 100 16 8 8 0 000-16zm0 2a6 6 0 110 12A6 6 0 0110 4z', time: '', state: 'pending' }
            ];

            const renderTracker = () => {
                listEl.innerHTML = statuses.map(status => {
                    const isCompleted = status.state === 'completed';
                    const isInProgress = status.state === 'progress';
                    return `
                    <li class="mb-10 ml-6">            
                        <span class="absolute flex items-center justify-center w-6 h-6 ${isCompleted ? 'bg-primary' : (isInProgress ? 'bg-primary-light animate-pulse' : 'bg-gray-200')} rounded-full -left-3 ring-8 ring-white">
                            <svg class="w-3 h-3 ${isCompleted ? 'text-white' : (isInProgress ? 'text-primary' : 'text-gray-600')}" fill="${isInProgress ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${status.icon}"></path></svg>
                        </span>
                        <h3 class="font-bold ${isCompleted || isInProgress ? 'text-secondary' : 'text-gray-500'}">${status.name}</h3>
                        ${status.time ? `<time class="block text-sm font-normal leading-none text-gray-400">${status.time}</time>` : ''}
                    </li>`;
                }).join('');
            };

            renderTracker();

            setTimeout(() => {
                statuses[0].state = 'completed';
                statuses[1].state = 'progress';
                renderTracker();
            }, 2000);

            setTimeout(() => {
                statuses[1].state = 'completed';
                statuses[1].time = formatTime(new Date());
                statuses[2].state = 'progress';
                statuses[2].time = 'Head to the counter!';
                renderTracker();
            }, 6000);
        }
        function handleFilter(category) {
            activeFilter.category = category;
            showScreen('home');
        }
        function handleSearch(term) {
            activeFilter.searchTerm = term;
            const menuGrid = document.getElementById('menu-grid');
            if (menuGrid) {
                const filteredItems = menuItems
                    .filter(item => item.isAvailable && (activeFilter.category === 'All' || item.category === activeFilter.category) && item.name.toLowerCase().includes(term.toLowerCase()));
                menuGrid.innerHTML = filteredItems.length > 0 ? filteredItems.map(item => createMenuItemCard(item)).join('') : '<p class="text-center text-gray-500 col-span-1 py-10">No items match your search.</p>';
            }
        }
        function showRatingModal(orderId) {
            const order = orderHistory.find(o => o.id === orderId);
            app.modal.innerHTML = `
            <div class="modal-backdrop fixed inset-0 bg-black/50 z-40" onclick="closeModal()"></div>
            <div class="modal-content fixed bottom-0 left-0 right-0 max-w-sm mx-auto bg-white p-5 rounded-t-2xl z-50">
                <h3 class="font-bold text-xl text-center">Rate Your Order</h3>
                <p class="text-center text-gray-500">${order.id}</p>
                <div class="star-rating flex justify-center text-4xl my-4" data-rating="0">
                    ${[1,2,3,4,5].map(i => `<span class="star" data-value="${i}" onmouseover="selectRating(event)" onclick="submitRating('${order.id}', ${i})">&#9733;</span>`).join('')}
                </div>
                <button onclick="closeModal()" class="w-full mt-2 bg-gray-200 text-gray-700 font-bold py-3 rounded-lg">Cancel</button>
            </div>`;
        }
        function selectRating(event) {
            const rating = event.target.dataset.value;
            const stars = event.target.parentElement.children;
            for (let star of stars) {
                star.classList.toggle('selected', star.dataset.value <= rating);
            }
        }
        function submitRating(orderId, rating) {
            const order = orderHistory.find(o => o.id === orderId);
            if(order) order.rated = true;
            closeModal();
            showScreen('order-history');
            showToast(`Rated ${rating} stars. Thank you!`);
        }
        function closeModal() { app.modal.innerHTML = ''; }
        function reOrderItems(orderId) {
            const order = orderHistory.find(o => o.id === orderId);
            if (order) {
                order.items.forEach(item => {
                    const menuItem = menuItems.find(mi => mi.id === item.id);
                    if (menuItem && menuItem.isAvailable) {
                        const itemInCart = cart.find(cartItem => cartItem.id === item.id);
                        if (itemInCart) itemInCart.quantity += item.qty;
                        else cart.push({ ...menuItem, quantity: item.qty });
                    }
                });
                updateCartCount();
                showToast(`${order.items.length} items added to cart`);
            }
        }
        function showToast(message) {
            const toastEl = document.createElement('div');
            toastEl.className = 'toast-notification bg-secondary text-white text-sm font-semibold py-2 px-4 rounded-full shadow-lg';
            toastEl.innerText = message;
            app.toast.appendChild(toastEl);
            setTimeout(() => {
                toastEl.classList.add('toast-fade-out');
                toastEl.addEventListener('animationend', () => toastEl.remove());
            }, 2500);
        }
        function setAdminTab(tabName) {
            adminActiveTab = tabName;
            renderAdminContent();
            document.querySelectorAll('#admin-dashboard button[onclick^="setAdminTab"]').forEach(btn => btn.classList.remove('border-primary', 'text-primary'));
            document.querySelector(`button[onclick="setAdminTab('${tabName}')"]`).classList.add('border-primary', 'text-primary');
        }
        function renderAdminContent() {
            const contentEl = document.getElementById('admin-content');
            if (adminActiveTab === 'live-orders') {
                contentEl.innerHTML = `
                <div class="grid grid-cols-3 gap-3 h-full">
                    <div class="bg-blue-100/60 rounded-lg p-2 flex flex-col"><h4 class="font-bold text-blue-800 text-center mb-2">New</h4><div id="col-new" class="space-y-2 flex-1" ondrop="drop(event, 'new')" ondragover="event.preventDefault()">${kitchenOrders.filter(o => o.status === 'new').map(createKitchenOrderCard).join('')}</div></div>
                    <div class="bg-yellow-100/60 rounded-lg p-2 flex flex-col"><h4 class="font-bold text-yellow-800 text-center mb-2">Preparing</h4><div id="col-preparing" class="space-y-2 flex-1" ondrop="drop(event, 'preparing')" ondragover="event.preventDefault()">${kitchenOrders.filter(o => o.status === 'preparing').map(createKitchenOrderCard).join('')}</div></div>
                    <div class="bg-green-100/60 rounded-lg p-2 flex flex-col"><h4 class="font-bold text-green-800 text-center mb-2">Ready</h4><div id="col-ready" class="space-y-2 flex-1" ondrop="drop(event, 'ready')" ondragover="event.preventDefault()">${kitchenOrders.filter(o => o.status === 'ready').map(createKitchenOrderCard).join('')}</div></div>
                </div>`;
            } else if (adminActiveTab === 'menu-manage') {
                contentEl.innerHTML = `
                <div class="space-y-3 pr-3">
                    ${menuItems.map(item => `
                        <div class="bg-white p-3 rounded-lg shadow-sm flex items-center justify-between">
                            <div>
                                <p class="font-bold">${item.name}</p>
                                <p class="text-sm text-gray-500">₹${item.price}</p>
                            </div>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="checkbox" ${item.isAvailable ? 'checked' : ''} onchange="toggleItemAvailability(${item.id})" class="sr-only peer">
                                <div class="relative w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                            </label>
                        </div>
                    `).join('')}
                </div>`;
            }
        }
        function toggleItemAvailability(itemId) {
            const item = menuItems.find(i => i.id === itemId);
            if (item) item.isAvailable = !item.isAvailable;
            showToast(`${item.name} is now ${item.isAvailable ? 'available' : 'unavailable'}`);
        }
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
        function drop(ev, newStatus) {
            ev.preventDefault();
            const orderId = ev.dataTransfer.getData("text");
            const order = kitchenOrders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                renderAdminContent();
            }
        }
        function createKitchenOrderCard(order) {
            return `
            <div id="${order.id}" draggable="true" ondragstart="drag(event)" class="bg-white rounded-lg p-2.5 shadow-sm border border-gray-200 cursor-grab active:cursor-grabbing">
                <div class="flex justify-between items-center pb-1 border-b">
                    <span class="text-xl font-black text-primary">#${order.token}</span>
                    <span class="text-xs font-semibold text-gray-600">${order.time}</span>
                </div>
                <div class="mt-2 space-y-1">
                    ${order.items.map(item => `<div class="flex items-center text-sm"><span class="font-bold text-gray-800">${item.qty}x</span><span class="ml-1 text-gray-700">${item.name}</span></div>`).join('')}
                </div>
            </div>`;
        }
        function toggleAccordion(element) {
            const content = element.nextElementSibling;
            element.querySelector('svg').classList.toggle('rotate-180');
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        }
        function showScheduleModal() {
            const timeSlots = ["6:30-6:45 PM", "6:45-7:00 PM", "7:00-7:15 PM"];
            app.modal.innerHTML = `
            <div class="modal-backdrop fixed inset-0 bg-black/50 z-40" onclick="closeModal()"></div>
            <div class="modal-content fixed bottom-0 left-0 right-0 max-w-sm mx-auto bg-white p-5 rounded-t-2xl z-50">
                <h3 class="font-bold text-xl text-center">Schedule Pickup</h3>
                <div class="grid grid-cols-2 gap-3 my-4">
                    ${timeSlots.map(slot => `<button onclick="setPickupTime('${slot}')" class="p-3 bg-gray-100 rounded-lg font-semibold text-gray-700 hover:bg-primary-light hover:text-primary">${slot}</button>`).join('')}
                </div>
            </div>`;
        }
        function setPickupTime(time) {
            currentOrder.scheduledTime = time;
            closeModal();
            showScreen('cart');
        }

        // --- INITIALIZATION ---
        window.onload = () => { 
            app.fab.innerHTML = `<button onclick="showScreen('cart')" class="bg-gradient-to-r from-primary to-orange-400 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center transform hover:scale-110 transition-transform"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c.51 0 .962-.343 1.087-.835l1.823-6.812a1.125 1.125 0 00-.328-1.182zM6.613 10.5h11.218" /></svg><span id="cart-item-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center border-2 border-white">0</span></button>`;
            app.nav.innerHTML = `
                <button data-screen="home" onclick="showScreen('home')" class="nav-item flex flex-col items-center justify-center text-gray-500 hover:text-primary transition-colors w-1/4">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7"><path d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0L2.41 11.47a.75.75 0 101.06 1.06l8-8z" /><path d="M12 5.432l8.159 8.159c.026.026.05.054.07.084v6.101a2.25 2.25 0 01-2.25 2.25H16.5a.75.75 0 01-.75-.75v-2.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.25a2.25 2.25 0 01-2.25-2.25v-6.101c.02-.03.044-.058.07-.084L12 5.432z" /></svg>
                    <span class="text-xs mt-1 font-semibold">Home</span>
                </button>
                <button data-screen="order-history" onclick="showScreen('order-history')" class="nav-item flex flex-col items-center justify-center text-gray-500 hover:text-primary transition-colors w-1/4">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7"><path d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0016.5 9h-1.875a.375.375 0 01-.375-.375V6.375A3.75 3.75 0 0010.5 2.625h-1.125A.375.375 0 019 2.25V1.5H5.625zM12.971 6.375a.75.75 0 011.06 0l.97.97a.75.75 0 010 1.06l-.97.97a.75.75 0 01-1.06 0l-.97-.97a.75.75 0 010-1.06l.97-.97zM15.75 8.625a.75.75 0 011.06 0l.97.97a.75.75 0 010 1.06l-.97.97a.75.75 0 01-1.06 0l-.97-.97a.75.75 0 010-1.06l.97-.97zM5.25 12.375a.75.75 0 011.06 0l.97.97a.75.75 0 010 1.06l-.97.97a.75.75 0 01-1.06 0l-.97-.97a.75.75 0 010-1.06l.97-.97zM8.25 12.375a.75.75 0 011.06 0l.97.97a.75.75 0 010 1.06l-.97.97a.75.75 0 01-1.06 0l-.97-.97a.75.75 0 010-1.06l.97-.97zM5.25 15.375a.75.75 0 011.06 0l.97.97a.75.75 0 010 1.06l-.97.97a.75.75 0 01-1.06 0l-.97-.97a.75.75 0 010-1.06l.97-.97zM8.25 15.375a.75.75 0 011.06 0l.97.97a.75.75 0 010 1.06l-.97.97a.75.75 0 01-1.06 0l-.97-.97a.75.75 0 010-1.06l.97-.97z" /></svg>
                    <span class="text-xs mt-1 font-semibold">History</span>
                </button>
                 <button data-screen="admin-dashboard" onclick="showScreen('admin-dashboard')" class="nav-item flex flex-col items-center justify-center text-gray-500 hover:text-primary transition-colors w-1/4">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7"><path fill-rule="evenodd" d="M3 6a3 3 0 013-3h12a3 3 0 013 3v12a3 3 0 01-3 3H6a3 3 0 01-3-3V6zm4.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM12 10.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm-1.5 4.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm4.5-4.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm-1.5 4.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm4.5-4.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" clip-rule="evenodd" /></svg>
                    <span class="text-xs mt-1 font-semibold">Admin</span>
                </button>
                <button data-screen="profile" onclick="showScreen('profile')" class="nav-item flex flex-col items-center justify-center text-gray-500 hover:text-primary transition-colors w-1/4">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7"><path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zm-12.54-1.285A7.486 7.486 0 0112 15a7.486 7.486 0 015.855 2.812A8.224 8.224 0 0112 20.25a8.224 8.224 0 01-5.855-2.438zM15.75 9a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" clip-rule="evenodd" /></svg>
                    <span class="text-xs mt-1 font-semibold">Profile</span>
                </button>
            `;
            showScreen('login'); 
        };
    </script>
</body>
</html>

